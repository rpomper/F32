<!DOCTYPE html>
<html>
  <head>
    <title>F32</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-audio-button-response.js"></script>
    <script src="jspsych/plugin-html-button-response-flexiblelocations.js"></script>
    <script src="jspsych/plugin-audio-button-response-flexiblelocations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>

    const jsPsych  = initJsPsych( {
        on_finish: function() {
            jsPsych.data.displayData('json');
        }
    });

    teaching_URL = 'https://raw.githubusercontent.com/rpomper/F32/main/orders/F32-Teaching-Order-1.csv?token=GHSAT0AAAAAABXYFRCKLCMZU56VK2F4TNVEYX6VLPA'
    link_URL = 'https://raw.githubusercontent.com/rpomper/F32/main/orders/F32-Link-Order-1.csv?token=GHSAT0AAAAAABXYFRCKBI766VYTZYAY2YCQYX6VLYQ'

    Papa.parse(teaching_URL, {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
            var teaching_trials = results.data
            console.log(teaching_trials)
            loadLinkTrials(teaching_trials);
        }
    })

    function loadLinkTrials(teaching_trials) {
        Papa.parse(link_URL, {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                var link_trials = results.data
                console.log(link_trials)
                startExperiment(teaching_trials,link_trials);
            }
        })
    }

    

    function createExperiment(teaching_trials,link_trials) {

        var timeline = []
            
        var phase;
        var imageStart='<img src= "stimuli/images/';
        var numButtonStop= '.jpg"  title = "" width="100" height="100">';
        var buttonStop= '.jpg"  title = "" width="100" height="50">';
        var imageStop= '.jpg"  title = "" width="300" height="300">';
        var audioExt="stimuli/sounds/";


        var choose_phase = {
            type: jsPsychHtmlButtonResponseFlexiblelocations,
            stimulus: "Choose phase:",
            // choices: ['<p style="font-size:48px; color:red;">1</p>', '<p style="font-size:48px; color:green;">2</p>', '<p style="font-size:48px; color:blue;">3</p>','<p style="font-size:48px; color:orange;">4</p>'],
            choices: [imageStart+"1"+numButtonStop,imageStart+"2"+numButtonStop,imageStart+"3"+numButtonStop,imageStart+"4"+numButtonStop],
            prompt: "",
            block_attribute: ['inline-block','inline-block','block','inline-block'],
            grid_attribute: true,
            margin_vertical: ['10px'],
            on_finish: function(data){
                console.log(data)
                console.log()
                phase = data.response+1
                console.log(phase)
            }
        }

        var blank_screen = {
            type:jsPsychHtmlButtonResponseFlexiblelocations,
            trial_duration:500,
            response_ends_trial: false,
            stimulus: "",
            prompt:"",
            choices: [imageStart+"blank-button"+buttonStop]
        }

        var study_prompt = {
            type: jsPsychAudioButtonResponseFlexiblelocations,
            trial_duration: 8800,
            response_ends_trial: false,
            stimulus: audioExt+"teaching/juss.wav",
            choices: [imageStart+"J3"+imageStop,imageStart+"blank-button"+buttonStop],
            prompt: "",
            block_attribute: ['inline-block','block'],
            grid_attribute: false,
            margin_vertical: ['20px'],
            on_finish: function(data){
                console.log(data)
            }
        }

        var retrieval_prompt = {
            type: jsPsychAudioButtonResponseFlexiblelocations,
            trial_duration: 3000,
            response_ends_trial: false,
            stimulus: audioExt+"teaching/prompt.wav",
            choices: [imageStart+"J3"+imageStop,imageStart+"blank-button"+buttonStop],
            prompt: "",
            block_attribute: ['inline-block','block'],
            grid_attribute: false,
            margin_vertical: ['20px'],
            on_finish: function(data){
                console.log(data)
            }
        } 

        var click_advance = {
            type: jsPsychHtmlButtonResponseFlexiblelocations,
            stimulus: "",
            choices: [imageStart+"J3"+imageStop,imageStart+"next-button"+buttonStop],
            prompt: "",
            block_attribute: ['inline-block','block'],
            grid_attribute: false,
            margin_vertical: ['20px'],
            on_finish: function(data){
                console.log(data)
            }
        }

        var study_trial = {
            timeline: [study_prompt,click_advance,blank_screen]
        }

        var retrieval_trial = {
            timeline: [retrieval_prompt,click_advance,blank_screen]
        }

        var link_trial = {
            type: jsPsychAudioButtonResponseFlexiblelocations,
            stimulus: audioExt+"link/juss.wav",
            // choices: ['<p style="font-size:48px; color:red;">1</p>', '<p style="font-size:48px; color:green;">2</p>', '<p style="font-size:48px; color:blue;">3</p>','<p style="font-size:48px; color:orange;">4</p>'],
            choices: [imageStart+"J3"+imageStop,imageStart+"A3"+imageStop,imageStart+"A33"+imageStop],
            prompt: "",
            block_attribute: ['inline-block','inline-block','block'],
            grid_attribute: false,
            margin_vertical: ['10px'],
            on_finish: function(data){
                console.log(data)
            }
        }

        var display_choice = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
                return "starting with "+phase
            },
            on_finish: function(data){
                console.log(data)
                console.log('end')}
        }

        timeline.push(choose_phase)

        var cur_trials = teaching_trials.filter(function(trial){return trial.block === 1})
        console.log(cur_trials)

        // for (var i = )

        return timeline

    }

    function startExperiment(teaching_trials,link_trials) {
        jsPsych.run(createExperiment(teaching_trials,link_trials))
    }


    // jsPsych.run([choose_phase,study_trial,retrieval_trial,link_trial]);
  </script>
</html>